<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NTU Racing Homework 2023: Docker Virtual Environment</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NTU Racing Homework 2023
   &#160;<span id="projectnumber">v0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Docker Virtual Environment </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md6"></a>
Introduction</h1>
<p>Virtual environment are commanly used in order to avoid unnecessary environment setups as a result of different computers with different software installed. Here docker is adoped as a comprehensive virtual environment that is applicable for every software.</p>
<p>We provide custom images for using ros, matlab, etc. on desktop computers or rpi, and handy bash scripts to control these virtual environment.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Before you start</h1>
<p>Install docker on your computer, please checkout <a href="https://docs.docker.com/engine/install/ubuntu/">Install Docker Engine on Ubuntu</a></p>
<h1><a class="anchor" id="autotoc_md8"></a>
Usage</h1>
<p>In order to use docker, first you have to build an image, and then create a container.</p>
<p>There two bash scripts provided to simplify the use of docker virtual environment, namely <code>build_image.sh</code> for building images and <code>start_container.sh</code> for managing containers.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
build_image.sh</h2>
<p>This script is used for building a docker image for a container to run on, use this script by</p>
<div class="fragment"><div class="line"> {bash=}</div>
<div class="line">./build_image.sh</div>
</div><!-- fragment --><p>you will be prompted to choose which docker image from dockerfiles in <code>Dockerfile</code> to build from.</p>
<blockquote class="doxtable">
<p>Note: The image name will be the same as the <code>dockerfile</code>'s name. </p>
</blockquote>
<p>If an existing image has the same name as the <code>dockerfile</code>'s name and the tag is <code>latest</code>, an option will prompt you to choose whether to change the existing image's tag to <code>older_versionX</code> and build the new image with tag <code>latest</code>.</p>
<h3><a class="anchor" id="autotoc_md10"></a>
Using bash arguments</h3>
<p>The script also support bash arguemnts as a short hand</p>
<div class="fragment"><div class="line"> {bash=}</div>
<div class="line">./build_image.sh IMAGE_FILE REPLACE_OPTION</div>
</div><!-- fragment --><p>where <code>IMAGE_FILE</code> is the dockerfile name in directory <code>Dockerfile</code> and <code>REPLACE_OPTION</code>(y/n) for controlling whether to change the tag of an image with same name to older vison.</p>
<h3><a class="anchor" id="autotoc_md11"></a>
Choosing which image to build</h3>
<p>The following are provided images:</p><ul>
<li>fun_time_with_arthur: image with ros and machine learning libraries</li>
<li>ros_host: image with ros for desktop use</li>
<li>ros_matlab: image with ros and matlabfor desktop use</li>
<li>ros_rpi: image with ros for use on raspberry pi</li>
</ul>
<p>For more information, please refer to <code>Image environment</code> in latter section.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
start_container.sh</h2>
<p>This script is used for managing a docker container, use this script by</p>
<div class="fragment"><div class="line"> {bash=}</div>
<div class="line">./start_container.sh</div>
</div><!-- fragment --><p>you will be prompted by different commands to manage docker containers:</p>
<h3><a class="anchor" id="autotoc_md13"></a>
create</h3>
<p>This command create a container from existing images.</p>
<blockquote class="doxtable">
<p>Note the host of the container will be the container's name and password in the container for default user <code>docker</code> is <code>docker</code>. </p>
</blockquote>
<blockquote class="doxtable">
<p>Note: In order to let the container be connectable to the interent, port <code>8080</code> with host ip <code>127.0.1.1</code> is designated for the container, so you can only run a container at a time that was created by <code>start_container.sh</code> script. </p>
</blockquote>
<h3><a class="anchor" id="autotoc_md14"></a>
run</h3>
<p>This command run a stopped container.</p>
<h3><a class="anchor" id="autotoc_md15"></a>
shell</h3>
<p>This command attach to the shell of a container, if the container is not running, the script will run it first.</p>
<blockquote class="doxtable">
<p>Note: If you want to exit container's shell, simply use <code>exit</code> command. </p>
</blockquote>
<h3><a class="anchor" id="autotoc_md16"></a>
stop</h3>
<p>This stop a running container.</p>
<h3><a class="anchor" id="autotoc_md17"></a>
Using bash arguments</h3>
<p>The script also support bash arguments as a short hand</p>
<div class="fragment"><div class="line"> {bash=}</div>
<div class="line">./start_container.sh COMMAND CONTAINER_NAME IMAGE_NAME</div>
</div><!-- fragment --><p>where <code>COMMAND</code> is the command listed above, <code>CONTAINER_NAME</code> is the container you want to manage, and <code>IMAGE_NAME</code> is for building container with specific image name.</p>
<h3><a class="anchor" id="autotoc_md18"></a>
Specific changes for deploying to rpi</h3>
<p>When creating a container from <code>ros_rpi</code> image, there will be some sepcific changes:</p>
<ol type="1">
<li>The network of the container and the host are not separated</li>
<li>The default user of the container is root</li>
</ol>
<p>In another word, creating and using this container is as if you are always root on the host, which is very dangerious, so please be careful!</p>
<h1><a class="anchor" id="autotoc_md19"></a>
Image environment</h1>
<p>The following is the description of the image environments.</p>
<h2><a class="anchor" id="autotoc_md20"></a>
fun_time_with_arthur</h2>
<p>The image is based on 11.7.0-base-ubuntu22.04, which is an ubuntu 20.04 image with Nvida cuda support and has the following applications installed:</p>
<ul>
<li>bash-completion -&gt; bash auto-complete</li>
<li>build-essential -&gt; compiler</li>
<li>byobu -&gt; terminal multiplexer</li>
<li>ca-certificates -&gt; certificate manager</li>
<li>curl -&gt; internet commuincation library</li>
<li>feh -&gt; image viewer</li>
<li>git -&gt; version control</li>
<li>gnupg2 -&gt; encryption</li>
<li>keyboard-configuration -&gt; keyboard configuration</li>
<li>locales -&gt; configure locale</li>
<li>libgl1-mesa-dev -&gt; mujoco-py dependancy</li>
<li>libgl1-mesa-glx -&gt; mujoco-py dependancy</li>
<li>libglew-dev -&gt; mujoco-py dependancy</li>
<li>libglfw3 -&gt; mujoco-py dependancy</li>
<li>libosmesa6-dev -&gt; mujoco-py dependancy</li>
<li>lsb-release -&gt; linux standard base</li>
<li>net-tools -&gt; network configurator</li>
<li>nvidia-cuda-toolkit -&gt; for using gpu</li>
<li>patchelf -&gt; mujoco-py dependancy</li>
<li>python3-colcon-common-extensions -&gt; build ros2 workspace</li>
<li>python3-pip -&gt; python package manager</li>
<li>python3-rosdep -&gt; ros dependencies manager</li>
<li>ros-humble-ros2-controllers -&gt; ros2 controllers</li>
<li>ros-humble-desktop-full -&gt; ros2</li>
<li>ros-humble-gazebo-ros-pkgs -&gt; gazebo</li>
<li>ros-humble-joint-state-publisher-gui -&gt; ros2 gui joint state publisher</li>
<li>ros-humble-plotjuggler -&gt; ros2 plotting tool</li>
<li>ros-humble-ros2-controllers -&gt; ros2 controllers</li>
<li>ros-humble-ros2-control-test-assets -&gt; test assets for ros2_control</li>
<li>ros-humble-ros2-socketcan -&gt; ros2 can driver</li>
<li>ros-humble-rqt-joint-trajectory-controller -&gt; controlling joint using gui</li>
<li>ros-humble-teleop-twist-keyboard -&gt; ros2 keyboard control</li>
<li>sudo -&gt; executing commands as root</li>
<li>swig -&gt; wrapper for C/C++ to connect to scripting language</li>
<li>tmux -&gt; terminal multiplexer</li>
<li>tzdata -&gt; timezone</li>
<li>vim -&gt; command line text editor</li>
<li>wget -&gt; downloader</li>
</ul>
<p>And python packages:</p>
<ul>
<li>envpool -&gt; simulating envrionment manager (but faster than opanAI-gym)</li>
<li>gym[mujoco] -&gt; simulating envrionment manager for mujoco (may be replaced by envpool)</li>
<li>mujoco-py -&gt; bindings for mujoco that's required for opneAI-gym</li>
<li>pygame -&gt; simulation environment for openAI gym</li>
<li>pythorch -&gt; machine learing engine</li>
<li>tqdm -&gt; progress bar</li>
<li>visdom -&gt; visualization tool for pytorch</li>
</ul>
<p>And other packages that are not installed traditionally</p>
<ul>
<li>mujoco -&gt; simulating environment</li>
<li>micro_ros_setup -&gt; micro ros support</li>
</ul>
<h2><a class="anchor" id="autotoc_md21"></a>
ros_host</h2>
<p>The image is based on ubuntu 20.04 with the following applications installed:</p>
<ul>
<li>bash-completion -&gt; bash auto-complete</li>
<li>build-essential -&gt; compiler</li>
<li>byobu -&gt; terminal multiplexer</li>
<li>ca-certificates -&gt; certificate manager</li>
<li>curl -&gt; internet commuincation library</li>
<li>feh -&gt; image viewer</li>
<li>git -&gt; version control</li>
<li>gnupg2 -&gt; encryption</li>
<li>gpsd -&gt; gps daemon</li>
<li>gpsd-clients -&gt; gps client</li>
<li>keyboard-configuration -&gt; keyboard configuration</li>
<li>lsb-release -&gt; linux standard base</li>
<li>net-tools -&gt; network configurator</li>
<li>python3-pip -&gt; python package manager</li>
<li>python3-rosdep -&gt; ros dependencies manager</li>
<li>python3-rosinstall -&gt; ros installation tool</li>
<li>python3-rosinstall-generator -&gt; ros install file generator</li>
<li>python3-wstool -&gt; ros version control</li>
<li>ros-noetic-desktop-full -&gt; ros</li>
<li>ros-noetic-gps-common -&gt; for using gps with ros</li>
<li>ros-noetic-gpsd-client -&gt; for using gps with ros</li>
<li>ros-noetic-teleop-twist-keyboard -&gt; ros keyboard control</li>
<li>ros-noetic-rqt-multiplot -&gt; ros multi-plotting tool</li>
<li>ros-noetic-socketcan-bridge -&gt; ros can tool</li>
<li>swig -&gt; wrapper for C/C++ to connect to scripting language</li>
<li>tmux -&gt; terminal multiplexer</li>
<li>tzdata -&gt; timezone</li>
<li>vim -&gt; command line text editor</li>
<li>wget -&gt; downloader</li>
</ul>
<p>And python packages</p>
<ul>
<li>gps3 -&gt; gps library</li>
<li>RPi.GPIO -&gt; accessing rpi gpio</li>
</ul>
<p>And other packages that are not installed traditionally</p>
<ul>
<li>wiringpi -&gt; gpio library for rpi</li>
</ul>
<h2><a class="anchor" id="autotoc_md22"></a>
ros_matlab</h2>
<p>The image is based on ubuntu 20.04 with the following applications installed:</p>
<ul>
<li>bash-completion -&gt; bash auto-complete</li>
<li>build-essential -&gt; compiler</li>
<li>byobu -&gt; terminal multiplexer</li>
<li>ca-certificates -&gt; certificate manager</li>
<li>curl -&gt; internet commuincation library</li>
<li>feh -&gt; image viewer</li>
<li>git -&gt; version control</li>
<li>gnupg2 -&gt; encryption</li>
<li>gpsd -&gt; gps daemon</li>
<li>gpsd-clients -&gt; gps client</li>
<li>keyboard-configuration -&gt; keyboard configuration</li>
<li>lsb-release -&gt; linux standard base</li>
<li>net-tools -&gt; network configurator</li>
<li>python3-pip -&gt; python package manager</li>
<li>python3-rosdep -&gt; ros dependencies manager</li>
<li>python3-rosinstall -&gt; ros installation tool</li>
<li>python3-rosinstall-generator -&gt; ros install file generator</li>
<li>python3-wstool -&gt; ros version control</li>
<li>ros-noetic-desktop-full -&gt; ros</li>
<li>ros-noetic-gps-common -&gt; for using gps with ros</li>
<li>ros-noetic-gpsd-client -&gt; for using gps with ros</li>
<li>ros-noetic-teleop-twist-keyboard -&gt; ros keyboard control</li>
<li>ros-noetic-rqt-multiplot -&gt; ros multi-plotting tool</li>
<li>ros-noetic-socketcan-bridge -&gt; ros can tool</li>
<li>swig -&gt; wrapper for C/C++ to connect to scripting language</li>
<li>tmux -&gt; terminal multiplexer</li>
<li>tzdata -&gt; timezone</li>
<li>vim -&gt; command line text editor</li>
<li>wget -&gt; downloader</li>
</ul>
<p>And python packages</p>
<ul>
<li>gps3 -&gt; gps library</li>
<li>RPi.GPIO -&gt; accessing rpi gpio</li>
</ul>
<p>And matlab products:</p>
<ul>
<li>Control_System_Toolbox</li>
<li>MATLAB</li>
<li>MATLAB_Coder</li>
<li>ROS_Toolbox</li>
<li>Simulink</li>
<li>Simulink_Coder</li>
<li>Simscape</li>
<li>Simscape_Driveline</li>
<li>Simescape_Electrical</li>
<li>Symbolic_Math_Toolbox</li>
<li>Vehicle_Dynamics_Blockset</li>
</ul>
<p>And other packages that are not installed traditionally</p>
<ul>
<li>wiringpi -&gt; gpio library for rpi</li>
</ul>
<h2><a class="anchor" id="autotoc_md23"></a>
ros_rpi</h2>
<p>The image is based on ubuntu 20.04 with the following applications installed:</p>
<ul>
<li>bash-completion -&gt; bash auto-complete</li>
<li>build-essential -&gt; compiler</li>
<li>byobu -&gt; terminal multiplexer</li>
<li>ca-certificates -&gt; certificate manager</li>
<li>curl -&gt; internet commuincation library</li>
<li>feh -&gt; image viewer</li>
<li>git -&gt; version control</li>
<li>gnupg2 -&gt; encryption</li>
<li>gpsd -&gt; gps daemon</li>
<li>gpsd-clients -&gt; gps client</li>
<li>keyboard-configuration -&gt; keyboard configuration</li>
<li>libyaml-cpp-dev -&gt; using yaml in cpp</li>
<li>lsb-release -&gt; linux standard base</li>
<li>net-tools -&gt; network configurator</li>
<li>python3-can -&gt; can library</li>
<li>python3-pip -&gt; python package manager</li>
<li>python3-rosdep -&gt; ros dependencies manager</li>
<li>python3-rosinstall -&gt; ros installation tool</li>
<li>python3-rosinstall-generator -&gt; ros install file generator</li>
<li>python3-serial -&gt; accessing serial port</li>
<li>python3-wstool -&gt; ros version control</li>
<li>ros-noetic-ros_base -&gt; ros base version</li>
<li>ros-noetic-gps-common -&gt; for using gps with ros</li>
<li>ros-noetic-gpsd-client -&gt; for using gps with ros</li>
<li>ros-noetic-socketcan-bridge -&gt; ros can tool</li>
<li>swig -&gt; wrapper for C/C++ to connect to scripting language</li>
<li>tmux -&gt; terminal multiplexer</li>
<li>tzdata -&gt; timezone</li>
<li>vim -&gt; command line text editor</li>
<li>wget -&gt; downloader</li>
</ul>
<p>And python packages</p>
<ul>
<li>gps3 -&gt; gps library</li>
<li>RPi.GPIO -&gt; accessing rpi gpio</li>
</ul>
<p>And other packages that are not installed traditionally</p>
<ul>
<li>wiringpi -&gt; gpio library for rpi</li>
</ul>
<h2><a class="anchor" id="autotoc_md24"></a>
ros2_host</h2>
<p>The image is based on ubuntu 22.04 with the following applications installed:</p>
<ul>
<li>bash-completion -&gt; bash auto-complete</li>
<li>build-essential -&gt; compiler</li>
<li>byobu -&gt; terminal multiplexer</li>
<li>ca-certificates -&gt; certificate manager</li>
<li>curl -&gt; internet commuincation library</li>
<li>feh -&gt; image viewer</li>
<li>git -&gt; version control</li>
<li>gnupg2 -&gt; encryption</li>
<li>keyboard-configuration -&gt; keyboard configuration</li>
<li>locales -&gt; configure locale</li>
<li>lsb-release -&gt; linux standard base</li>
<li>net-tools -&gt; network configurator</li>
<li>python3-pip -&gt; python package manager</li>
<li>python3-rosdep -&gt; ros2 dependencies manager</li>
<li>ros-humble-ros2-controllers -&gt; ros2 controllers</li>
<li>ros-humble-desktop-full -&gt; ros2</li>
<li>ros-humble-gazebo-ros-pkgs -&gt; gazebo</li>
<li>ros-humble-plotjuggler -&gt; ros2 plotting tool</li>
<li>ros-humble-ros2-controllers -&gt; ros2 controllers</li>
<li>ros-humble-ros2-control-test-assets -&gt; test assets for ros2_control</li>
<li>ros-humble-ros2-socketcan -&gt; ros2 can driver</li>
<li>ros-humble-teleop-twist-keyboard -&gt; ros2 keyboard control</li>
<li>swig -&gt; wrapper for C/C++ to connect to scripting language</li>
<li>tmux -&gt; terminal multiplexer</li>
<li>tzdata -&gt; timezone</li>
<li>vim -&gt; command line text editor</li>
<li>wget -&gt; downloader</li>
</ul>
<h2><a class="anchor" id="autotoc_md25"></a>
ROS enviroment</h2>
<p>There will be ros workspace directory preconfigured in <code>/home/docker/ws</code> and its subdirectory <code>src</code> mounted to the host as <code>./packages/CONTAINER_NAME</code>.</p>
<p>The workspace <code>~/ws</code> has already been build(catkin_make) once, so there will also be <code>build</code> and <code>devel</code> directory beside the <code>src</code>.</p>
<h2><a class="anchor" id="autotoc_md26"></a>
ROS1</h2>
<p>The general ros environment setup</p>
<div class="fragment"><div class="line"> {bash=}</div>
<div class="line">source /opt/ros/noetic/setup.bash</div>
<div class="line">source ~/ws/devel/setup.bash</div>
</div><!-- fragment --><p>has already being included in <code>~/.bashrc</code> file, so there is no need to source them everytime.</p>
<h2><a class="anchor" id="autotoc_md27"></a>
ROS2</h2>
<p>The general ros2 environment setup</p>
<div class="fragment"><div class="line"> {bash=}</div>
<div class="line">source /opt/ros/humble/setup.bash</div>
<div class="line">source ~/ws/install/setup.bash</div>
</div><!-- fragment --><p>has already being included in <code>~/.bashrc</code> file, so there is no need to source them everytime.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
Support for using nvidia gpu in docker</h2>
<p>The script <code>start_container.sh</code> support for using gpu inside docker container when creating container, and will automatically create containers if your docker have nvidia docker support. Checkout how to setup nvidia docker support: <a href="https://www.howtogeek.com/devops/how-to-use-an-nvidia-gpu-with-docker-containers/">How to Use an NVIDIA GPU with Docker Containers</a>.</p>
<h1><a class="anchor" id="autotoc_md29"></a>
Known Issues</h1>
<ol type="1">
<li>We have some issues when building on WSL. Such as using byobu and visualize environments.</li>
<li>Inorder to use matlab, you first have to have the license and the license for matlab cloud use. Campus-wide licenses are already configured for cloud use, if your authorization failed with error code <code>4402</code>, please contact your license provider.</li>
<li><p class="startli">If it is on <b>Debian</b>, follow the steps to solve libseccomp:</p>
<p class="startli">```bash= #download from <a href="https://packages.debian.org/sid/libseccomp2">https://packages.debian.org/sid/libseccomp2</a>, for example: wget <a href="http://ftp.tw.debian.org/debian/pool/main/libs/libseccomp/libseccomp2_2.5.3-2_armhf.deb">http://ftp.tw.debian.org/debian/pool/main/libs/libseccomp/libseccomp2_2.5.3-2_armhf.deb</a> sudo dpkg -i libseccomp2_2.5.3-2_armhf.deb ref: <a href="https://askubuntu.com/questions/1263284/apt-update-throws-signature-error-in-ubuntu-20-04-container-on-arm">https://askubuntu.com/questions/1263284/apt-update-throws-signature-error-in-ubuntu-20-04-container-on-arm</a> ``` </p>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
